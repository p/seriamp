#!/usr/bin/env ruby

begin
  require 'seriamp/sonamp/auto_power'
rescue LoadError
  $: << File.join(File.dirname(__FILE__), '../lib')
  require 'seriamp/sonamp/auto_power'
end
require 'optparse'
require 'logger'

options = {}
OptionParser.new do |opts|
  opts.banner = "Usage: sonamp-auto-power [-l log-path] [-D]"

  opts.on("--daemonize", "-D", "Daemonize") do
    options[:daemonize] = true
  end

  opts.on("--log=PATH", "-l", "Path to log file") do |path|
    options[:log_path] = path
  end

end.parse!

logger = Logger.new(STDERR)

runner = AutoPower.new(logger: logger)

if options[:daemonize]
  Process.daemonize
end

runner.run
